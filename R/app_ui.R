#' The application User-Interface
#' 
#' @param request Internal parameter for `{shiny}`. 
#'     DO NOT REMOVE.
#' @import shiny
#' @noRd
#' 

# TODO: work out how to import the data properly - it's currently in inst and loaded
# automatically, then called in the ui and server separately.

app_ui <- function(request) {
  
  metadata <- golem::get_golem_options("metadata")
  meta_sum <- get_condition_summary(metadata)
  samples <- get_all_sample_names(metadata)
  bab_light_blue <- "#00aeef"
  bab_dark_blue <- "#1d305f"
  #thematic::thematic_on(bg = "#1d305f", fg = "white")
  
  tagList(
    # Leave this function for adding external resources
    golem_add_external_resources(),
    # List the first level UI elements here 
    fluidPage(
      theme = bslib::bs_theme(
        bg = bab_dark_blue, 
        fg = "white", 
        primary = bab_light_blue,
        secondary = bab_light_blue),
      titlePanel(
        tags$img(
          src = "bioinformatics_logo_square_small.png", 
          style="margin-top: -10px; padding-right:10px; padding-bottom:10px", 
          width = "70", 
          height = "70",
          align = "right"
          ),
        windowTitle="spex"
      ),
      br(),
      #titlePanel("Dataset title"),
      tabsetPanel(
        tabPanel(
          "info",
          br(),
          sidebarLayout(
            sidebarPanel(
              width = 3,
              selectInput(
                inputId = "choose_dataset",
                label = "Choose dataset",
                choices = c("to be populated", 2, 3),
              ),
              p("Explore your chosen dataset by using the tabs above."),
              p("Sample names and experimental conditions are shown in the metadata section."),
              p("The data tab shows the whole dataset, which can be downloaded if required."),
              p("A range of plots can be viewed and downloaded to explore different aspects of the dataset.")
            ),
            mainPanel(
              br(),
              titlePanel(h1("dataset name", align = "center")),
              br(),
              h5("Information about the dataset and publication link"),
              br(),br(),br(),
              br(),br(),br(),br(),br(),br(),br(),
              h6("For more information about work carried out at the Babraham Institute
                 visit the", a(href= "https://www.babraham.ac.uk/", "website")),
              br(),br(),br(),br()
            )
          )  
        ),  
        tabPanel(
          "metadata",
          br(),
          sidebarLayout(
            sidebarPanel(
              width = 3,
              checkboxInput("show_meta", "show all metadata", value = TRUE),
                # checkboxInput("show_meta_summary", "show metadata summary"),
                # conditionalPanel(condition = "input.show_meta_summary == 1",
                #                  selectInput("selected_condition", 
                #                              "select condition",
                #                              #choices = meta_sum)
                #                              choices = names(meta_sum)),
                # ),
              actionButton("browser", "browser")
            ),
            mainPanel(
              width = 9,
              conditionalPanel(
                condition = "input.show_meta_summary == 1",
                tableOutput("meta_summary")
              ),
              conditionalPanel(
                condition = "input.show_meta == 1", 
                DT::dataTableOutput("meta_table")
              )
            )
          )
        ),
        tabPanel(
          "data",
          br(),
          DT::dataTableOutput("data_table")
        ),
        tabPanel(
          "plot",
          navlistPanel(
            "plot type",
            tabPanel("histogram", mod_histogramUI("hist")),
            tabPanel("scatterplot", mod_scatterplot_ui("scatter", samples, meta_sum)),
            tabPanel("boxplot", mod_boxplot_ui("boxplot", samples, meta_sum)),
            widths = c(3,9)
          )
        ),
        tabPanel(
          "filter",
          wellPanel(
            style = "margin: 10px 0px",
            h3("Filter summary: "),
            textOutput("filter_summary"),
            actionButton("browser", "browser")
          ),
          navlistPanel(
            id = "nav_name",
            well = FALSE,
            widths = c(3,9)
          ),
          wellPanel(
            fluidRow(
              column(
                width = 4, 
                offset = 2,
                align = "center",
                actionButton("filter_button", "Filter data")
              ),
              column(
                width = 4,
                align = "center",
                actionButton("clear_filters", "Clear all filters")
              )  
            )
          )
        )
      ),
      br(),
      fluidRow(
        column(
          width = 3,
          tags$img(src = "bioinformatics_logo_small_grey.png", width = "200", height = "71")
        ),
        column(
          width = 6,
          offset = 3,
          br(),
          br(),
          p("Any problems please email laura.biggins@babraham.ac.uk", style = "font-size:12px", align = "right")
        )  
      ),
      # flowLayout(
      #   tags$img(src = "bioinformatics_logo_small_grey.png", width = "200", height = "71"),
      #   p("Any problems please email laura.biggins@babraham.ac.uk", style = "font-size:12px", align = "right")
      # ),
      br()
    )
  )
}

#' Add external Resources to the Application
#' 
#' This function is internally used to add external 
#' resources inside the Shiny application. 
#' 
#' @import shiny
#' @importFrom golem add_resource_path activate_js favicon bundle_resources
#' @noRd
golem_add_external_resources <- function(){
  
  add_resource_path(
    'www', app_sys('app/www')#, package = "spex")
  )
 
  tags$head(
    favicon(),
    bundle_resources(
      path = app_sys('app/www'),
      app_title = 'spex'
    )
    # Add here other external resources
    # for example, you can add shinyalert::useShinyalert() 
  )
}

